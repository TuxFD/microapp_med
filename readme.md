# microapp_med
Дипломная работа. Концепт микросервиса для автономного ведения пациентов с хроническими заболеваниями в гос.учреждениях. Цель разработки - повысить доступность услуг узкопрофильных врачей-специалистов для конкретной категории пациентов. Своевременное диагностирование и наблюдение хронических заболеваний улучшает качество жизни пациентов, повышает их трудоспособность и снижает рост инвалидности и смертности в моменты высокой нагрузки на Систему Здравоохранения (например, пандемия Covid-19)

Микросервис обладает MVС архитектурой, не имеет собственного GUI и его представление выполняет функции API-соединения со сторонним ПО Госуслуг и базы данных Здравоохранения. 

## Навигация:
* Бизнес-процессы и эффект от внедрения
* Структура базы данных
* Работа контроллера

## Бизнес-процессы и эффект от внедрения

Процесс записи к врачам-специалистам на данный момент:

![DFD v.1](/concept/DFD.png)

Ожидаемый результат при внедрении микросервиса представлен ниже. Решение не вносит кардинальных изменений в процессы и его можно откатить к исходному варианту в случаи неудачи.

![DFD v.2](/concept/DFD2.png)

## Структура базы данных

Состоит из 9 таблиц.

|Имя таблицы|Назначение|
|---|---|
|tb_schedule</b> | основная таблица, хранящая даты предстоящих и повторных записей пациентов, а также информацию о доступности слотов прямой записи к врачам-специалистам |
|tb_person| пациент|
|tb_chrill| хроническое заболевание|
|tb_chrill_type| тип хронического заболевания|
|tb_doctor| врач-специалист|
|tb_doctor_type| тип врача-специалиста|

|Буферные таблицы для связи многие ко многим|
|---|
| tb_doctor_tb_doctor_type|
| tb_person_tb_doctor|
| tb_person_tb_chrill|


![база данных микросервиса](/concept/БД.png)


### Работа контроллера
Серверная часть микросервиса ежедневно вызывает метод контроллера "daemon_check()", который:
* Проверяет предстоящие и плановые записи пациентов
* Запрашивает слоты прямой записи к специалистам
* Отправляет уведомления пациентам

Подробнее - код контроллера.

Контроллер использует SQL-запросы модели:
~~~sql
-- 1 Получить из БД микросервиса массив данных на обработку контроллером:
SELECT 
    ts.id, 
    ts.active_status,
    tp.OMC_number,
    td.doctor_identifier, 
    ts.last_check, 
    ts.timing_gap, 
    ts.next_check, 
    ts.reminder_day_before, 
    ts.slots_check_available
FROM
    tb_schedule as ts,
    tb_person as tp,
    tp_doctor as td
WHERE
    ts.person_id = tp.id
AND
    ts.doctor_id = td.id
;

-- 2 Запланировать дату повторного запроса слотов прямой записи:
UPDATE tb_schedule as ts
SET slots_check_available = placeholder1
WHERE ts.id = placeholder2;
~~~